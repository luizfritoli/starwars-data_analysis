# -- Carregando o Tidyverse e Ggcorrplot --
```{r}
# install.packages("tidyverse")
library(tidyverse)
# install.packages("ggcorrplot")
library(ggcorrplot)
```

# -- Carregando os dados tratados --
```{r}
dados = read_csv("../data/clean/starwars_clean.csv")
View(dados)
```

# -- Analisando correlação entre "altura" e "massa" --
```{r}

correl = dados %>%
  select(altura, massa) %>%
  cor(use="complete.obs")

correl_filt = dados %>%
  filter(massa < 1000) %>% 
  select(altura, massa) %>%
  cor(use="complete.obs")

ggcorrplot(correl_filt,
           lab=T,
           lab_size = 3.5)

ggcorrplot(correl,
           lab=T,
           lab_size = 3.5)
```

# -- Confirmando existência de correlação com gráfico de dispersão --
```{r}

dados %>%
  ggplot(aes(x=altura, y=massa)) +
  geom_point() + geom_smooth(method="lm")

dados %>%
  filter(massa < 1000) %>%
  ggplot(aes(x=altura, y=massa)) +
  geom_point() + geom_smooth(method="lm") +
  geom_vline(xintercept=165, linetype="dotted") +
  geom_hline(yintercept=70, linetype="dotted")
```

# -- Analisando proporções de gêneros --
```{r}
genero = dados %>%
  group_by(genero) %>%
  summarise(n = n())

dados %>%
  filter(genero %in% c("feminine", "masculine")) %>%
  group_by(genero, cor_olho) %>%
  summarise(n = n())

genero %>%
  mutate(genero = case_match(genero,
                             "masculine" ~ "Masculino",
                             "feminine" ~ "Feminino",
                             "not specified" ~ "Não especificado"
                             ),
         percent = (n / sum(n)) * 100,
         p_label = paste0(n, " (", round(percent, 1), "%)")
         ) %>%
  ggplot(aes(x = "", y = n, fill = genero)) +
  geom_bar(stat="identity", width=0.5) +
  coord_flip() +
  geom_text(aes(label = p_label), 
            position = position_stack(vjust = 0.5)) +
  theme_void() +
  labs(
    title = "Proporção dos gêneros",
    fill = "Gêneros"
  )
```
